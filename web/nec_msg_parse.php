<?php
    include('../tpl/header.php');
    include('../lib/html_common.inc');
    include('../lib/misc.inc');
    
    # 依斷行區分NEC電文
    // $nec_msg = '20160509201605090000102016050923595900811100331762500000000004640001842070012469005725000696557002408056000012663000006454000012288000016517000000223000000044000000000000000000000000000000000000';
    $nec_msg = '20170313201703130000202017031323595900830100333857200000000004440001865180012807006182000700329002400675000012732000006434000019124000025286000000348000000068000001040000005600000000019000000015';# new
    // $nec_msg = '20170307201703070000002017030723595900791500319803200000000004090001676060011421005755000755935002248659000013743000006026000012480000008392000000227000000022000000800000004160000000015000000011';# old
    $nec_msg = str_replace("\r", '', $nec_msg);
    $nec_msg_list = explode("\n", $nec_msg);
    
    foreach ($nec_msg_list as $m_idx => $t_msg) {
        if ($m_idx == 0) {
            # Header 解析長度
            $cut_len_list = array(8,8,6,8,6,6,9,7,6,9,7,6,9,9,9,9,9,9,9,9,9,9,9,9);
        } else {
            # Body 解析長度
            $cut_len_list = array(12,9,1,1,10,6,1,10,6,1,1,1,1,5,2,5,1,1,5,2,5,1,1,5,2,5,1,1,5,2,5,1,1,5,2,5,1,1,5,2,5,1,1,5,2,5,1,1,5,2,5,16,1,3,1,3,1,3,1,3);
        }
        
        $s_idx = 0;
        foreach ($cut_len_list as $t_len) {                
            $t_str = substr($t_msg, $s_idx , $t_len);
            disp($t_str);
            $s_idx += $t_len;
        }
        disp('');
    }
    
    include('../tpl/footer.php');
?>